<!DOCTYPE html>
<html lang="en">

    <head><title>eddiequinn.xyz</title>
<meta name="description" content="A general purpose blog for me to braindump anything I might be thinking about. Please don’t hesitate to reach out if you have any questions.">

<meta name="viewport" content="width=device-width, initial-scale=1">
<meta charset="UTF-8"/>



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.9.4/css/academicons.min.css" integrity="sha512-IW0nhlW5MgNydsXJO40En2EoCkTTjZhI3yuODrZIc8cQ4h1XcF53PsqDHa09NqnkXuIe0Oiyyj171BqZFwISBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />


<link rel="stylesheet" href="https://eddiequinn.xyz/css/palettes/base16-dark.css">
<link rel="stylesheet" href="https://eddiequinn.xyz/css/risotto.css">
<link rel="stylesheet" href="https://eddiequinn.xyz/css/custom.css">










</head>

    <body>
        <div class="page">

            <header class="page__header"><nav class="page__nav main-nav">
    <ul>
      <li class="nomarker"><h1 class="page__logo"><a href="https://eddiequinn.xyz/" class="page__logo-inner">eddiequinn.xyz</a></h1></li>
    
    
    <li class="main-nav__item"><a class="nav-main-item" href="https://eddiequinn.xyz/posts/" title="">posts</a></li>
    
    <li class="main-nav__item"><a class="nav-main-item" href="https://eddiequinn.xyz/nts/" title="">nts</a></li>
    
    <li class="main-nav__item"><a class="nav-main-item" href="https://eddiequinn.xyz/build-logs/" title="">build-logs</a></li>
    
    </ul>
</nav>

</header>

            <section class="page__body">
    <header class="content__header">
        <h1></h1>
    </header>
    <div class="content__body">
        <p>Hey, been a while… as usual. This is very much thrown together as a post, but I wanted to document the completion of two pretty big projects. I have finally deployed a K3S cluster in my homelab, and I have successfully moved from Arch to NixOS.</p>
<blockquote>
<p>⚠️ <strong>Warning:</strong> This is not a tutorial or guide. Please run the commands in this post at your own risk.</p>
</blockquote>
<hr>
<h2 id="i-use-nix-btw">I use Nix BTW</h2>
<p>I finally moved from using Arch Linux as my OS of choice to running NixOS. It seemed like a natural next step in me becoming an insufferable no-lifer. I won’t pit Kubernetes and NixOS against each other for which one I have intended to switch to for longer; both have held court in the tattered throne-room that is my prefrontal cortex for so long they are better treated as jesters rather than legitimate guests.</p>
<p>I moved over to NixOS around four months ago because my Arch install finally keeled over and died. I could either prolong my pain using it or just install Nix like I had been saying I wanted to do for at least two years. I bit the bullet, creating an incredibly misguided abomination of a flake. Things were good… then I proceeded to break the flake after three days and used a Nix build two generations old for a third of a year.</p>
<p>Why I eventually fixed this, I do not know. It may be as simple as one day at work a coworker was annoying me and I decided to plan out a new Git repo called <strong>Atlantis</strong>, which threw fresh goals onto the smithery inside my brain.</p>
<p>Atlantis was born, so named after the club frequented by solos in <em>Night City</em> in <em>Cyberpunk 2020</em>. Atlantis was going to be different — elegant, stable. Atlantis sat for two weeks with no work beyond a basic skeleton. Then just as the coals were about to cough their last plume, the NixOS jester spilt his flagon atop them, and the ethanol lit a three‑day sprint of building, tweaking, committing, and refactoring.</p>
<p>I now have a functioning, Git-backed, fully declarative operating system at my fingertips. It is rare that I leave a project feeling fulfilled, but this was one of those times. I am genuinely happy with what I achieved.</p>
<hr>
<h3 id="gpg-unification">GPG Unification</h3>
<p>The coolest thing I did in all of this was unify my GPG and SSH setup.</p>
<p>This is something I had wanted to do for a long time, but doing it on Arch meant learning everything, implementing it, and then inevitably repeating the process after the next reinstall. With NixOS, I only had to set it up once.</p>
<p>When I initially set up my GPG keys, I made mistakes:</p>
<ol>
<li>Uploading my root key to Keybase (your private key should never touch the internet — I knew this and did it anyway).</li>
<li>Not using subkeys.</li>
<li>Not uploading my key to a keyserver.</li>
</ol>
<p>Over the course of a wet February evening, I installed TailsOS onto a USB stick, booted into it, and generated the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>pub   ed25519/0xB254FBF3F060B796 2026-02-05 [SC] [expires: 2031-02-04]
</span></span><span style="display:flex;"><span>uid   [ultimate] Eddie Brinton-Quinn &lt;eddie@b-quinn.com&gt;
</span></span><span style="display:flex;"><span>sub   ed25519/0x72E0089944E7C367 2026-02-05 [S]
</span></span><span style="display:flex;"><span>sub   cv25519/0x51FC7D57ABD18A33 2026-02-05 [E]
</span></span><span style="display:flex;"><span>sub   ed25519/0x4AAC046885DFBC2B 2026-02-05 [A]
</span></span><span style="display:flex;"><span>sub   ed25519/0xBFEEDA71CC19B0C6 2026-02-05 [A]
</span></span></code></pre></div><p>That is a primary key with four subkeys:</p>
<ul>
<li>One for signing</li>
<li>One for encryption</li>
<li>Two for authentication (one per device)</li>
</ul>
<p>Six hours later, I had a <code>+85 -7</code> merge request. The file doing most of the work looked like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span>{ config<span style="color:#f92672">,</span> pkgs<span style="color:#f92672">,</span> lib<span style="color:#f92672">,</span> <span style="color:#f92672">...</span> }:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  programs<span style="color:#f92672">.</span>gpg <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    enable <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    settings <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      keyserver <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;hkps://keys.openpgp.org&#34;</span>;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  services<span style="color:#f92672">.</span>gpg-agent <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    enable <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    enableSshSupport <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    enableZshIntegration <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    pinentry<span style="color:#f92672">.</span>package <span style="color:#f92672">=</span> pkgs<span style="color:#f92672">.</span>pinentry-gtk2;
</span></span><span style="display:flex;"><span>    defaultCacheTtl <span style="color:#f92672">=</span> <span style="color:#ae81ff">3600</span>;
</span></span><span style="display:flex;"><span>    maxCacheTtl <span style="color:#f92672">=</span> <span style="color:#ae81ff">86400</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  programs<span style="color:#f92672">.</span>zsh<span style="color:#f92672">.</span>initContent <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    export SSH_AUTH_SOCK=&#34;$(</span><span style="color:#e6db74">${</span>pkgs<span style="color:#f92672">.</span>gnupg<span style="color:#e6db74">}</span><span style="color:#e6db74">/bin/gpgconf --list-dirs agent-ssh-socket)&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  &#39;&#39;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  programs<span style="color:#f92672">.</span>ssh <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    enable <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>    enableDefaultConfig <span style="color:#f92672">=</span> <span style="color:#66d9ef">false</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    matchBlocks<span style="color:#f92672">.</span><span style="color:#e6db74">&#34;all&#34;</span> <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>      host <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;*&#34;</span>;
</span></span><span style="display:flex;"><span>      identityAgent <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/run/user/1000/gnupg/S.gpg-agent.ssh&#34;</span>;
</span></span><span style="display:flex;"><span>    };
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I am proud of this. Genuinely.</p>
<hr>
<h2 id="i-use-k3s-btw">I use K3S BTW</h2>
<p>The actual reason I started writing this: I deployed a K3S cluster.</p>
<p>Why? Partly curiosity. Partly ego. Partly because I enjoy pushing my understanding of GitOps, virtualization, Docker, and infrastructure to uncomfortable places.</p>
<p>I do not need a HA cluster. But I wanted one.</p>
<p>My main blocker historically wasn’t Kubernetes — it was repetition. I refuse to manually build and rebuild seven VMs every time I change something. That feels pointless.</p>
<p>So I needed Infrastructure as Code.</p>
<hr>
<h2 id="i-use-opentofu-btw">I use OpenTofu BTW</h2>
<p>OpenTofu and Terraform are both IaC tools. Terraform moved to the BSL license; OpenTofu forked under MPL-2.0.</p>
<p>That’s the main difference.</p>
<p>With some research, a few LLM prompts, YouTube, and a case of Hazy Jane, I ended up with the following Proxmox configuration:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-tf" data-lang="tf"><span style="display:flex;"><span><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;proxmox_vm_qemu&#34;</span> <span style="color:#e6db74">&#34;k3s&#34;</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">for_each</span> = <span style="color:#a6e22e">local</span>.<span style="color:#a6e22e">nodes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">name</span>        = <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">${</span>var.<span style="color:#a6e22e">name_prefix</span><span style="color:#e6db74">}</span><span style="color:#e6db74">-</span><span style="color:#e6db74">${</span>each.<span style="color:#a6e22e">key</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">target_node</span> = var.<span style="color:#a6e22e">target_node</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">clone</span>       = var.<span style="color:#a6e22e">clone_template</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">vmid</span>        = each.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">vmid</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">full_clone</span>  = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">tags</span>        = <span style="color:#e6db74">&#34;k3s-cluster&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">agent</span>       = <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">skip_ipv6</span>   = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">cpu</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">cores</span> = each.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">cpu</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">type</span>  = <span style="color:#e6db74">&#34;host&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">memory</span>  = each.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">mem</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">os_type</span> = <span style="color:#e6db74">&#34;cloud-init&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">network</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">id</span>      = <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">model</span>   = <span style="color:#e6db74">&#34;virtio&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">bridge</span>  = var.<span style="color:#a6e22e">bridge</span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">macaddr</span> = each.<span style="color:#a6e22e">value</span>.<span style="color:#a6e22e">macaddr</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ciuser</span>    = var.<span style="color:#a6e22e">ci_user</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">sshkeys</span>   = var.<span style="color:#a6e22e">ssh_public_key</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a6e22e">ipconfig0</span> = var.<span style="color:#a6e22e">ipconfig0</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Terraform builds the VMs. Ansible provisions them. k3sup bootstraps the cluster.</p>
<hr>
<h2 id="i-use-k3sup-btw">I use k3sup BTW</h2>
<p>k3sup installs and manages k3s over SSH.</p>
<p>Bootstrap command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>k3sup install <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --ip 10.0.6.11 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --tls-san 10.0.6.10 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --cluster <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --user k3s-agent <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --local-path ~/.kube/config <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --context k3s-ha <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span>  --k3s-extra-args <span style="color:#e6db74">&#34;disable servicelb --node-ip 10.0.6.11&#34;</span>
</span></span></code></pre></div><p>kube-vip provides a virtual IP (10.0.6.10) for HA API access.</p>
<p>After joining the remaining nodes, I ended up with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl get nodes -o wide
</span></span></code></pre></div><p>Seven nodes. Three control-plane. Four workers. HA etcd. Stable.</p>
<p>And now I have a cluster I need to actually use.</p>
<p>Next step: GitOps.</p>
<hr>
<h2 id="aftercare">Aftercare</h2>
<p>Would I recommend this?</p>
<p>Absolutely not.</p>
<p>You will fall into one of three camps:</p>
<ul>
<li><strong>“Wow, that’s awesome.”</strong> You’re already planning to do this.</li>
<li><strong>“Should I do this?”</strong> If this is you — probably not. You don’t need a declarative OS or HA cluster unless it excites you.</li>
<li><strong>“This sounds pointless.”</strong> That’s fine too.</li>
</ul>
<p>If you are not filled with excitement at the thought of building this, save your energy for something that does.</p>
<p>It works. I built it. Now I get to see what I can do with it.</p>
<p>See you in nine months when I post again.</p>

    </div>
    <footer class="content__footer"></footer>

            </section>

            <section class="page__aside">
                <div class="aside__about">
<div class="aside__about">
    
    
<h1 class="about__title">whoami</h1>
<p class="about__description">A general purpose blog for me to braindump anything I might be thinking about. Please don’t hesitate to reach out if you have any questions.</p>
</div>


<ul class="aside__social-links">
    
    <li>
        <a href="https://keybase.io/eddiequinn/pgp_keys.asc?fingerprint=551d835e4f1549e058c53eafbd4a349d47a8179c" rel="me" aria-label="Public Key" title="Public Key"><i class="fa-solid fa-key" aria-hidden="true"></i></a>&nbsp;
    </li>
    
    <li>
        <a href="https://github.com/eddiebquinn/" rel="me" aria-label="GitHub" title="GitHub"><i class="fa-brands fa-github" aria-hidden="true"></i></a>&nbsp;
    </li>
    
    <li>
        <a href="mailto:info@pranonym.com" rel="me" aria-label="Email" title="Email"><i class="fa-solid fa-envelope" aria-hidden="true"></i></a>&nbsp;
    </li>
    
    <li>
        <a href="https://www.linkedin.com/in/edward-b-quinn/" rel="me" aria-label="LinkedIn" title="LinkedIn"><i class="fa-brands fa-linkedin" aria-hidden="true"></i></a>&nbsp;
    </li>
    
    <li>
        <a href="https://eddiequinn.xyz/posts/index.xml" rel="me" aria-label="RSS" title="RSS"><i class="fa-solid fa-square-rss" aria-hidden="true"></i></a>&nbsp;
    </li>
    
</ul>
</div>
                <hr>
                <div class="aside__content">
    
    

    

                </div>
            </section>

            <footer class="page__footer"><p>
    
    
    
    
    
    
      
    
      
    
      
    
    
    
      
      
          
            
            
                <br/><span class="active"><b></b></span><br/>
            
          
      
    
</p>
<br /><br />
<p class="copyright">Any and all opinions listed here are my own and are not representative of any of my employers, past, future, and/or present</p>
<p class="advertisement">Powered by <a href="https://gohugo.io/">hugo</a> and <a href="https://github.com/joeroe/risotto">risotto</a>.</p>
</footer>

        </div>
    </body>

</html>
